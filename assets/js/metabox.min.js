"use strict";!function(d){d.fn.botigaMetabox=function(){return this.each(function(){var e=d(this),t=e.find(".botiga-metabox-tab"),i=e.find(".botiga-metabox-content");t.each(function(){var t=d(this);t.on("click",function(e){e.preventDefault();e=i.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),d(document).trigger("botiga-metabox-content-show",e)})});var a=i.find(".botiga-metabox-field-repeater");a.length&&a.each(function(){var i=d(this).find("ul");i.sortable({axis:"y",cursor:"move",helper:"original",handle:".botiga-metabox-field-repeater-move"}),a.find(".botiga-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var t=i.find("li").first().clone(!0),e=t.find("input");e.attr("name",e.data("name")),t.removeClass("hidden"),i.append(t)}),a.find(".botiga-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),d(this).closest("li").remove()})});var l=i.find(".botiga-metabox-field-uploads");l.length&&l.each(function(){var a,n,o=d(this).find("ul");o.sortable({axis:"y",cursor:"move",helper:"original",handle:".botiga-metabox-field-uploads-move"}),l.find(".botiga-metabox-field-uploads-add").on("click",function(e){e.preventDefault();var t=d(".botiga-metabox-field-uploads-list li").length,i=o.find("li").first().clone(!0),a=i.find("input[type=hidden]"),n=i.find("input[type=text]"),e="".concat(a.data("name"),"[").concat(t,"][image]"),t="".concat(n.data("name"),"[").concat(t,"][video]");a.attr("name",e),n.attr("name",t),i.removeClass("hidden"),o.append(i)}),l.find(".botiga-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),n=d(this).closest("li").find("input[type=text]"),a=a&&null,(a=window.wp.media({library:{type:o.data("library")||"image"}}).open()).on("select",function(){var e=a.state().get("selection").first().toJSON();n.val(e.url)})}),l.find(".botiga-metabox-field-image-upload").on("click",function(e){e.preventDefault();var t=d(this).closest("li").find(".botiga-img-wrapper");n=d(this).closest("li").find("input[type=hidden]");var i=d(this).closest("li").find(".botiga-metabox-field-image-upload");a=a&&null,(a=window.wp.media({library:{type:"image"}}).open()).on("select",function(){var e=a.state().get("selection").first().toJSON();t.html(""),t.append('<img src="'.concat(e.url,'" alt="" style="max-width:100%;"/>')),t.append('<span class="botiga-metabox-close-button dashicons dashicons-no-alt"></span>'),n.val(e.id),d(i).addClass("image-upload-absolute")})}),l.find(".botiga-metabox-field-uploads-list-item").on("click",".botiga-metabox-close-button",function(e){e.preventDefault();var t=d(this).closest("li").find(".botiga-img-wrapper"),i=d(this).closest("li").find("input[type=hidden]"),e=d(this).closest("li").find(".botiga-metabox-field-image-upload");i.val(""),d(e).removeClass("image-upload-absolute"),t.html("")}),l.find(".botiga-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),d(this).closest("li").remove()})});var n=i.find(".botiga-metabox-field-size-chart");n.length&&(n.on("multidimensional",function(e,t){(t||n).find("input").each(function(){var e=d(this),t=Math.max(0,e.closest("li").index()-1),i=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+i+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),n.each(function(){var t=d(this).find("ul");n.on("click",".botiga-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){d(this).attr("name",d(this).data("name")),d(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),n.trigger("multidimensional",[e])}),n.on("click",".botiga-add-col",function(e){e.preventDefault();var t=d(this).closest("td"),e=d(this).closest("table");d(this).closest("tbody").find("tr td:nth-child("+(t.index()+1)+")").each(function(){var e=d(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),n.trigger("multidimensional",[e])}),n.on("click",".botiga-del-col",function(e){e.preventDefault();var t=d(this).closest("td"),i=d(this).closest("table"),e=d(this).closest("tr").find("td").length,t=d(this).closest("tbody").find("tr td:nth-child("+(t.index()+1)+")");2<e?t.remove():t.find("input").val(""),n.trigger("multidimensional",[i])}),n.on("click",".botiga-add-row",function(e){e.preventDefault();var t=d(this).closest("tr"),i=d(this).closest("table"),e=t.clone(!0);e.find("input").val(""),t.after(e),n.trigger("multidimensional",[i])}),n.on("click",".botiga-del-row",function(e){e.preventDefault();var t=d(this).closest("tr"),e=d(this).closest("table");2<d(this).closest("tbody").find("tr").length?t.remove():t.find("input").val(""),n.trigger("multidimensional",[e])}),n.on("click",".botiga-remove",function(e){e.preventDefault(),d(this).closest("li").remove(),n.trigger("multidimensional")}),n.on("click",".botiga-duplicate",function(e){e.preventDefault();var t=d(this).closest("li"),e=t.clone(!0);t.after(e),n.trigger("multidimensional")})}));t=d(".botiga-metabox-field-media");t.length&&t.each(function(){var i,e=d(this),a=e.find(".botiga-metabox-field-media-input"),n=e.find(".botiga-metabox-field-media-preview img"),t=e.find(".botiga-metabox-field-media-upload"),o=e.find(".botiga-metabox-field-media-remove"),l=n.data("placeholder");t.on("click",function(e){e.preventDefault(),i||(i=window.wp.media({library:{type:"image"}})).on("select",function(){var e=i.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;a.val(e.id),n.attr("src",t),o.removeClass("hidden")}),i.open()}),o.on("click",function(e){e.preventDefault(),a.val(""),n.attr("src",l),o.addClass("hidden")})});var o=d(".botiga-metabox-field-select-ajax");o.length&&o.each(function(){var e=d(this).find("select"),t=e.data("source"),i=window.botiga_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:i.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"botiga_select_ajax",nonce:i.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),o.find(".select2-selection--multiple").append('<span class="botiga-select2-clear"></span>')});t=d(".botiga-metabox-field-wc-attributes");t.length&&t.each(function(){d(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),d(document).on("botiga-metabox-content-show",function(e,t){var i=d(t);i.data("code-editor-initalized")||((t=d(".botiga-metabox-field-code-editor",i)).length&&t.each(function(){var e=d(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),i.data("code-editor-initalized",!0))});t=i.find("[data-depend-on]");t.length&&t.each(function(){var t=d(this),e=i.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=i.find('[data-depend-on="'+t.data("depend-on")+'"]');d(this).is(":checked")?e.removeClass("botiga-metabox-field-hidden"):e.addClass("botiga-metabox-field-hidden")}),e.data("depend-on",!0))})})},d(document).ready(function(e){e(".botiga-metabox").botigaMetabox()})}(jQuery);