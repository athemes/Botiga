"use strict";!function(l){l.fn.botigaMetabox=function(){return this.each(function(){var e=l(this),t=e.find(".botiga-metabox-tab"),i=e.find(".botiga-metabox-content");t.each(function(){var t=l(this);t.on("click",function(e){e.preventDefault();e=i.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),l(document).trigger("botiga-metabox-content-show",e)})});var a=i.find(".botiga-metabox-field-repeater");a.length&&a.each(function(){var i=l(this).find("ul");i.sortable({axis:"y",cursor:"move",helper:"original",handle:".botiga-metabox-field-repeater-move"}),a.find(".botiga-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var t=i.find("li").first().clone(!0),e=t.find("input");e.attr("name",e.data("name")),t.removeClass("hidden"),i.append(t)}),a.find(".botiga-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),l(this).closest("li").remove()})});var n=i.find(".botiga-metabox-field-uploads");n.length&&n.each(function(){var t,i,a=l(this).find("ul");a.sortable({axis:"y",cursor:"move",helper:"original",handle:".botiga-metabox-field-uploads-move"}),n.find(".botiga-metabox-field-uploads-add").on("click",function(e){e.preventDefault();var t=a.find("li").first().clone(!0),e=t.find("input");e.attr("name",e.data("name")),t.removeClass("hidden"),a.append(t)}),n.find(".botiga-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),i=l(this).closest("li").find("input"),t?t.open():(t=window.wp.media({library:{type:a.data("library")||"image"}}).open()).on("select",function(){var e=t.state().get("selection").first().toJSON();i.val(e.url)})}),n.find(".botiga-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),l(this).closest("li").remove()})});var o=i.find(".botiga-metabox-field-size-chart");o.length&&(o.on("multidimensional",function(e,t){(t||o).find("input").each(function(){var e=l(this),t=Math.max(0,e.closest("li").index()-1),i=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+i+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),o.each(function(){var t=l(this).find("ul");o.on("click",".botiga-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){l(this).attr("name",l(this).data("name")),l(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),o.trigger("multidimensional",[e])}),o.on("click",".botiga-add-col",function(e){e.preventDefault();var t=l(this).closest("td"),e=l(this).closest("table");l(this).closest("tbody").find("tr td:nth-child("+(t.index()+1)+")").each(function(){var e=l(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),o.trigger("multidimensional",[e])}),o.on("click",".botiga-del-col",function(e){e.preventDefault();var t=l(this).closest("td"),i=l(this).closest("table"),e=l(this).closest("tr").find("td").length,t=l(this).closest("tbody").find("tr td:nth-child("+(t.index()+1)+")");2<e?t.remove():t.find("input").val(""),o.trigger("multidimensional",[i])}),o.on("click",".botiga-add-row",function(e){e.preventDefault();var t=l(this).closest("tr"),i=l(this).closest("table"),e=t.clone(!0);e.find("input").val(""),t.after(e),o.trigger("multidimensional",[i])}),o.on("click",".botiga-del-row",function(e){e.preventDefault();var t=l(this).closest("tr"),e=l(this).closest("table");2<l(this).closest("tbody").find("tr").length?t.remove():t.find("input").val(""),o.trigger("multidimensional",[e])}),o.on("click",".botiga-remove",function(e){e.preventDefault(),l(this).closest("li").remove(),o.trigger("multidimensional")}),o.on("click",".botiga-duplicate",function(e){e.preventDefault();var t=l(this).closest("li"),e=t.clone(!0);t.after(e),o.trigger("multidimensional")})}));t=l(".botiga-metabox-field-media");t.length&&t.each(function(){var i,e=l(this),a=e.find(".botiga-metabox-field-media-input"),n=e.find(".botiga-metabox-field-media-preview img"),t=e.find(".botiga-metabox-field-media-upload"),o=e.find(".botiga-metabox-field-media-remove"),d=n.data("placeholder");t.on("click",function(e){e.preventDefault(),i||(i=window.wp.media({library:{type:"image"}})).on("select",function(){var e=i.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;a.val(e.id),n.attr("src",t),o.removeClass("hidden")}),i.open()}),o.on("click",function(e){e.preventDefault(),a.val(""),n.attr("src",d),o.addClass("hidden")})});var d=l(".botiga-metabox-field-select-ajax");d.length&&d.each(function(){var e=l(this).find("select"),t=e.data("source"),i=window.botiga_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:i.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"botiga_select_ajax",nonce:i.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),d.find(".select2-selection--multiple").append('<span class="botiga-select2-clear"></span>')});t=l(".botiga-metabox-field-wc-attributes");t.length&&t.each(function(){l(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),l(document).on("botiga-metabox-content-show",function(e,t){var i=l(t);i.data("code-editor-initalized")||((t=l(".botiga-metabox-field-code-editor",i)).length&&t.each(function(){var e=l(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),i.data("code-editor-initalized",!0))});t=i.find("[data-depend-on]");t.length&&t.each(function(){var t=l(this),e=i.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=i.find('[data-depend-on="'+t.data("depend-on")+'"]');l(this).is(":checked")?e.removeClass("botiga-metabox-field-hidden"):e.addClass("botiga-metabox-field-hidden")}),e.data("depend-on",!0))})})},l(document).ready(function(e){e(".botiga-metabox").botigaMetabox()})}(jQuery);